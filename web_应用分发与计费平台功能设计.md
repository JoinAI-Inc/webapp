# Web 应用分发与计费平台（Steam-like）功能设计文档

## 1. 文档目的

设计一个 Web 版本的「应用分发与计费平台」，用于统一管理公司内部及对外提供的 Web 应用，支持应用上架、用户访问控制、订阅与单次购买计费，并与第三方支付平台（Stripe）对接。

系统分为 **管理端（Admin）** 与 **应用端（User / App Store）** 两部分。

---

## 2. 系统角色与使用视角

### 2.1 管理端（Admin）
- 公司内部使用
- 负责应用管理、收费项目配置、收入与订单管理

### 2.2 应用端（User）
- 面向最终用户
- 用于浏览应用、订阅或购买应用、访问已授权应用

---

## 3. 系统整体模块划分

- 应用管理模块（App Management）
- 收费与计费模块（Pricing & Billing）
- 授权与访问控制模块（Entitlement & Access Control）
- 收入与订单模块（Revenue & Orders）
- 第三方支付集成（Stripe）

---

## 4. 管理端功能设计

### 4.1 用户管理（User Management）

- 查看用户列表
  - 显示用户邮箱、姓名、总消费金额
  - 显示订单数量、活跃授权数量
  - 支持按消费金额、订单数量排序
- 用户详情页
  - 查看用户基本信息
  - 查看订单历史记录
  - 查看当前拥有的授权（订阅或买断）
  - 总消费金额统计
- 用户状态管理
  - 锁定用户：禁止用户访问服务
  - 解锁用户：恢复用户访问权限

---

### 4.2 应用管理（App Management）

- 创建 / 编辑 / 下架 Web 应用
- 应用基础信息维护：
  - 应用名称
  - 应用唯一标识（AppKey）
  - 应用描述
  - 应用访问地址（URL）
  - 当前状态（草稿 / 已上架 / 已下架）
- 应用与收费项目的绑定关系管理

---

### 4.3 收费项目管理（Pricing Management）

收费项目必须依附于「应用」或「平台级能力」，不允许脱离应用独立存在。

#### 4.2.1 收费模式类型

**模式一：订阅制（Subscription）**
- 可选范围：
  - **平台级订阅**：订阅后可访问平台内全部 Web 应用
  - **应用级订阅**：订阅后仅可访问指定的单个或多个应用
- 支持订阅周期：
  - 月度（MONTH）
  - 季度（QUARTER）
  - 年度（YEAR）
- 核心特征：
  - 有明确有效期
  - 支持自动续费（配置项）

**模式二：单次购买（One-time Purchase）**
- 可选范围：
  - **单应用购买**：针对单个应用的永久使用权
  - **多应用包购买**：针对多个应用的永久使用权
- 一次性付费
- 永久使用权

---

#### 4.2.2 收费项目配置项

- 收费项目名称
- 收费类型（订阅 SUBSCRIPTION / 单次购买 ONE_TIME）
- 关联应用范围：
  - **不选择应用** = 平台级（GLOBAL），可访问所有应用
  - **选择特定应用** = 应用级（SPECIFIC_APP），仅可访问选中的应用
- 价格
- 币种
- 计费周期（如为订阅类型）
- 状态（启用 / 停用）

---

### 4.4 收入与订单管理（Revenue & Orders）

#### 4.3.1 收入总览
- 平台总收入
- 按时间维度统计（天 / 月）
- 按收费模式统计（订阅 / 单次购买）

#### 4.3.2 收入与订单明细
- 订单列表
- 单笔订单信息包括：
  - 用户标识
  - 收费项目
  - 支付金额
  - 支付状态
  - 创建时间

---

## 5. 应用端功能设计

### 5.1 应用商店（App Store）

- 应用列表浏览
- 应用详情页：
  - 应用介绍
  - 使用说明
  - 收费方式说明（仅显示该应用的一次性购买选项，如有）
- 购买入口（针对单个应用）
- **平台订阅入口**（独立页面，订阅后可访问全部应用）

---

### 5.2 用户授权状态展示

- 用户可查看：
  - 当前订阅状态
  - 已购买的应用列表
- 明确展示授权有效期或永久状态

---

### 5.3 应用访问与校验

- 提供统一的应用访问入口
- 访问前进行授权校验：
  - 用户身份
  - 授权记录（Entitlement）
- 校验失败则拒绝访问

---

## 6. 支付与计费边界说明

### 6.1 职责划分

- 第三方支付平台负责：
  - 支付处理
  - 退款
  - 订阅扣费与续费

- 本系统负责：
  - 收费项目建模
  - 授权状态管理
  - 应用访问控制

---

### 6.2 授权（Entitlement）概念模型

- 授权记录由「用户 × 收费项目」生成
- 授权类型：
  - 订阅授权（有有效期）
  - 永久授权（无有效期）
- 授权状态是应用访问的唯一判断依据

---

## 7. 非目标与刻意不做的事情

- 不支持复杂促销体系（优惠券、折扣、满减）
- 不涉及分销与返佣机制
- 不处理税务与发票逻辑
- 不在当前阶段支持企业账号或团队 Seat 模型

---

## 8. 后续可扩展方向（不在本次设计范围）

- 团队订阅与 Seat-based 授权
- API 调用量计费
- Webhook 驱动的应用启停
- 内部应用与外部应用的权限隔离

---

## 9. 设计约束与原则

- 收费项目必须绑定应用或平台能力
- 支付成功不等于立即可访问，必须生成授权记录
- 授权状态是访问控制的唯一来源
- 平台不信任客户端状态，仅基于服务端授权判断

